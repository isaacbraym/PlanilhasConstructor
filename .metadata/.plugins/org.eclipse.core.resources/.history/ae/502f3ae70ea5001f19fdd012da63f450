package com.abnote.planilhas.estilos.estilos;

import java.util.Map;

import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.CellStyle;
import org.apache.poi.ss.usermodel.Font;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;

public class Fontes {

	private final Workbook workbook;
	private final Sheet sheet;
	private final Map<String, CellStyle> styleCache;

	public Fontes(Workbook workbook, Sheet sheet, Map<String, CellStyle> styleCache) {
		this.workbook = workbook;
		this.sheet = sheet;
		this.styleCache = styleCache;
	}

	public void aplicarFonte(String fontName, int rowIndex, int columnIndex, int startRowIndex, int startColumnIndex,
			int endRowIndex, int endColumnIndex, boolean isRange, boolean isEntireSheet) {

		if (isRange) {
			for (int rowIdx = startRowIndex; rowIdx <= endRowIndex; rowIdx++) {
				Row row = sheet.getRow(rowIdx);
				if (row == null)
					continue;
				for (int colIdx = startColumnIndex; colIdx <= endColumnIndex; colIdx++) {
					Cell cell = row.getCell(colIdx);
					if (cell == null)
						continue;
					applyFontNameToCell(cell, fontName);
				}
			}
		} else if (rowIndex != -1) {
			if (columnIndex == -1) {
				// Aplicar à linha inteira
				Row row = sheet.getRow(rowIndex);
				if (row != null) {
					for (Cell cell : row) {
						if (cell != null) {
							applyFontNameToCell(cell, fontName);
						}
					}
				}
			} else {
				// Aplicar à célula específica
				Row row = sheet.getRow(rowIndex);
				if (row != null) {
					Cell cell = row.getCell(columnIndex);
					if (cell != null) {
						applyFontNameToCell(cell, fontName);
					}
				}
			}
		}
	}

	private void applyFontNameToCell(Cell cell, String fontName) {
		// Obter o estilo atual da célula
		CellStyle currentStyle = cell.getCellStyle();

		// Clonar o estilo atual
		CellStyle newStyle = workbook.createCellStyle();
		newStyle.cloneStyleFrom(currentStyle);

		// Obter a fonte atual
		Font currentFont = workbook.getFontAt(currentStyle.getFontIndex());

		// Criar nova fonte com as alterações
		Font newFont = workbook.createFont();
		newFont.setFontName(fontName != null ? fontName : currentFont.getFontName());
		newFont.setFontHeightInPoints(currentFont.getFontHeightInPoints());
		newFont.setBold(currentFont.getBold());
		newFont.setItalic(currentFont.getItalic());
		newFont.setUnderline(currentFont.getUnderline());
		newFont.setColor(currentFont.getColor());
		newFont.setTypeOffset(currentFont.getTypeOffset());
		newFont.setStrikeout(currentFont.getStrikeout());
		newFont.setCharSet(currentFont.getCharSet());

		// Associar a nova fonte ao novo estilo
		newStyle.setFont(newFont);

		// Aplicar o novo estilo à célula
		cell.setCellStyle(newStyle);
	}

	public void aplicarTamanhoFonte(int fontSize, int rowIndex, int columnIndex, int startRowIndex,
			int startColumnIndex, int endRowIndex, int endColumnIndex, boolean isRange, boolean isEntireSheet) {

		if (isRange) {
			for (int rowIdx = startRowIndex; rowIdx <= endRowIndex; rowIdx++) {
				Row row = sheet.getRow(rowIdx);
				if (row == null)
					continue;
				for (int colIdx = startColumnIndex; colIdx <= endColumnIndex; colIdx++) {
					Cell cell = row.getCell(colIdx);
					if (cell == null)
						continue;
					applyFontSizeToCell(cell, fontSize);
				}
			}
		} else if (rowIndex != -1) {
			if (columnIndex == -1) {
				// Aplicar à linha inteira
				Row row = sheet.getRow(rowIndex);
				if (row != null) {
					for (Cell cell : row) {
						if (cell != null) {
							applyFontSizeToCell(cell, fontSize);
						}
					}
				}
			} else {
				// Aplicar à célula específica
				Row row = sheet.getRow(rowIndex);
				if (row != null) {
					Cell cell = row.getCell(columnIndex);
					if (cell != null) {
						applyFontSizeToCell(cell, fontSize);
					}
				}
			}
		}
	}

	private void applyFontSizeToCell(Cell cell, int fontSize) {
		// Obter o estilo atual da célula
		CellStyle currentStyle = cell.getCellStyle();

		// Clonar o estilo atual
		CellStyle newStyle = workbook.createCellStyle();
		newStyle.cloneStyleFrom(currentStyle);

		// Obter a fonte atual
		Font currentFont = workbook.getFontAt(currentStyle.getFontIndex());

		// Criar nova fonte com as alterações
		Font newFont = workbook.createFont();
		newFont.setFontName(currentFont.getFontName());
		newFont.setFontHeightInPoints((short) fontSize);
		newFont.setBold(currentFont.getBold());
		newFont.setItalic(currentFont.getItalic());
		newFont.setUnderline(currentFont.getUnderline());
		newFont.setColor(currentFont.getColor());
		newFont.setTypeOffset(currentFont.getTypeOffset());
		newFont.setStrikeout(currentFont.getStrikeout());
		newFont.setCharSet(currentFont.getCharSet());

		// Associar a nova fonte ao novo estilo
		newStyle.setFont(newFont);

		// Aplicar o novo estilo à célula
		cell.setCellStyle(newStyle);
	}
}
