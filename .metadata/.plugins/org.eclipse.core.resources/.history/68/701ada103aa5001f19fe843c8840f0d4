package com.abnote.planilhas.estilos.estilos;

import java.util.Map;

import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.CellStyle;
import org.apache.poi.ss.usermodel.Font;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;

public class BoldStyle {

	private final Workbook workbook;
	private final Sheet sheet;
	private final Map<String, CellStyle> styleCache;

	public BoldStyle(Workbook workbook, Sheet sheet, Map<String, CellStyle> styleCache) {
		this.workbook = workbook;
		this.sheet = sheet;
		this.styleCache = styleCache;
	}

	public void aplicarBold(int rowIndex, int columnIndex, int startRowIndex, int startColumnIndex, int endRowIndex,
			int endColumnIndex, boolean isRange) {
		if (isRange) {
			for (int rowIdx = startRowIndex; rowIdx <= endRowIndex; rowIdx++) {
				Row row = sheet.getRow(rowIdx);
				if (row == null)
					continue;
				for (int colIdx = startColumnIndex; colIdx <= endColumnIndex; colIdx++) {
					Cell cell = row.getCell(colIdx);
					if (cell == null)
						continue;
					applyBoldToCell(cell);
				}
			}
		} else if (rowIndex != -1) {
			if (columnIndex == -1) {
				// Aplicar negrito a toda a linha
				Row row = sheet.getRow(rowIndex);
				if (row != null) {
					for (Cell cell : row) {
						if (cell != null) {
							applyBoldToCell(cell);
						}
					}
				}
			} else {
				// Aplicar negrito a uma célula específica
				Row row = sheet.getRow(rowIndex);
				if (row != null) {
					Cell cell = row.getCell(columnIndex);
					if (cell != null) {
						applyBoldToCell(cell);
					}
				}
			}
		}
	}

	private void applyBoldToCell(Cell cell) {
		// Obter o estilo atual da célula
		CellStyle currentStyle = cell.getCellStyle();

		// Clonar o estilo atual
		CellStyle newStyle = workbook.createCellStyle();
		newStyle.cloneStyleFrom(currentStyle);

		// Obter a fonte atual
		Font currentFont = workbook.getFontAt(currentStyle.getFontIndex());

		// Criar nova fonte com negrito
		Font newFont = workbook.createFont();
		newFont.setFontName(currentFont.getFontName());
		newFont.setFontHeightInPoints(currentFont.getFontHeightInPoints());
		newFont.setBold(true); // Definir negrito
		newFont.setItalic(currentFont.getItalic());
		newFont.setUnderline(currentFont.getUnderline());
		newFont.setColor(currentFont.getColor());
		newFont.setTypeOffset(currentFont.getTypeOffset());
		newFont.setStrikeout(currentFont.getStrikeout());
		newFont.setCharSet(currentFont.getCharSet());

		// Associar a nova fonte ao novo estilo
		newStyle.setFont(newFont);

		// Aplicar o novo estilo à célula
		cell.setCellStyle(newStyle);
	}
}
